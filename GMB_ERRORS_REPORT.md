# ?? ????? ????? GMB Dashboard - Production Bugs

## ? ??????: ?? ????? ??????? ??????

---

## ?? ??????? ?????? (CRITICAL) - ?? ??????? ?

### 1. **??? ?? Sync API - ??????? user.id ????? user = null** ? ?? ???????
**?????:** `app/api/gmb/sync/route.ts`

**??????? (?? ????):**
- ????? ???? ????? ?? cron job? ??? ???? authentication ? user ???? `null`
- ????? ??? ?????? `user.id` ?? ??? ????? (??????: 907, 991, 1035, 1113, 1161)

**???? ??????:**
```typescript
// ?? ????? ??? ????? 797:
const userId = user?.id || account.user_id;
if (!userId) {
  return NextResponse.json({ error: 'Cannot determine user_id' }, { status: 400 });
}

// ?? ??????? ???? ????????? user.id ?? userId:
- user_id: user.id  ?
+ user_id: userId   ?
```

**??????? ????????:**
- ? ????? 917: locationRows
- ? ????? 1001: reviewRows  
- ? ????? 1045: mediaRows
- ? ????? 1123: metricRows
- ? ????? 1171: keywordRows

---

## ?? ??????? ???????? (MEDIUM) - ?? ??????? ?

### 2. **?????? ??????? ?? Token Refresh** ? ?? ???????
**?????:** `app/api/gmb/posts/publish/route.ts`

**??????? (?? ????):**
- ??? ??? token refresh? ?? ??? ???? ?????? ????? ?????

**???? ??????:**
- ? ????? try-catch ???? ?? token refresh
- ? ????? ????? ??? ????? ?? error codes
- ? ????? ??? ????? ???? ?? ???????? ????? ???????

---

### 3. **Potential Crash ?? Performance Chart** ? ?? ???????
**?????:** `components/dashboard/performance-chart.tsx`

**??????? (?? ????):**
- ??????? `Math.min/Math.max` ??? array ?? ????? ??? NaN ?? undefined

**???? ??????:**
```typescript
// ????? ??? ??? valid ratings ??? ??????? Math.min/Max
const validRatings = data
  .map(d => d.rating)
  .filter(rating => typeof rating === 'number' && !isNaN(rating) && rating >= 0 && rating <= 5)

let domain: [number, number]
if (validRatings.length === 0) {
  domain = [0, 5] // fallback
} else {
  const minRating = Math.min(...validRatings)
  const maxRating = Math.max(...validRatings)
  domain = [Math.max(0, Math.floor(minRating) - 0.5), Math.min(5, Math.ceil(maxRating) + 0.5)]
}
```

---

## ?? ????? ?????? (MEDIUM) - ????? ??????

### 4. **????? ?? scheduled-sync - HTTP request ?????** ??
**?????:** `app/api/gmb/scheduled-sync/route.ts`

**???????:**
- ????? 150: ????? ??? HTTP request ????? ???? ???????
- ??? ?? ???? ?? ??? ??????? (???? serverless functions)
- ??? ???? - ??? ??????? sync logic ??????

**???? ???????:**
- ??????? sync logic ?????? ????? ?? HTTP request
- ?? ??????? message queue/background job

---

## ?? ??????? ?????? (LOW Priority)

### 5. **Console.log ?? Production**
- ???? **205 console statements** ?? API routes
- ??? ????????? ?? logging service (Sentry, LogRocket, etc.)

### 6. **Error Handling ?? Catch Blocks**
- ??? catch blocks ?????? `.catch(() => ({}))` ???? logging
- ??? ??? ????? log ??????? ????????

**??????? ????????:**
- `app/api/gmb/location/[locationId]/update/route.ts`
- `app/api/gmb/location/[locationId]/attributes/route.ts`
- `app/api/gmb/location/[locationId]/route.ts`
- `app/api/gmb/disconnect/route.ts`
- `app/api/gmb/attributes/route.ts`
- `app/api/gmb/scheduled-sync/route.ts`
- `app/api/gmb/chains/search/route.ts`
- `app/api/gmb/chains/[chainId]/route.ts`
- `app/api/gmb/google-locations/search/route.ts`
- `app/api/gmb/categories/route.ts`
- `app/api/gmb/posts/publish/route.ts` (????? 132)

### 7. **Type Safety**
- ??? ??????? ?????? `any` type
- ???? ??????? ?? TypeScript types ??? ???? ????

---

## ?? ???? ?????????

### ? ?? ??????? (3 ????? ????/??????):
1. ? ??? CRITICAL ?? sync route - user.id null reference
2. ? ????? error handling ?? token refresh
3. ? ????? potential crash ?? performance chart

### ?? ????? ?????? (??????? ??????):
1. ?? scheduled-sync implementation (HTTP request ?????)
2. ?? ????? console.log (205 statements)
3. ?? ????? error handling ?? catch blocks

---

## ?? ??? ?????

### Database Schema:
- ?? ?? ???? ???? columns ?????? (????? ?? posts/create ? posts/list)
- ??? ?????? ?? ???? migrations ?? ???????

### Environment Variables:
- ??? ?????? ?? ???? ???? env vars:
  - ? `GOOGLE_CLIENT_ID`
  - ? `GOOGLE_CLIENT_SECRET`
  - ? `GOOGLE_REDIRECT_URI`
  - ? `CRON_SECRET`
  - ? `NEXT_PUBLIC_BASE_URL`
  - ? `NEXT_PUBLIC_SUPABASE_URL`
  - ? `NEXT_PUBLIC_SUPABASE_ANON_KEY`
  - ? `SUPABASE_SERVICE_ROLE_KEY`

---

## ? ???????

**??????? ?????? ?? ???????! ?**

?????? ???? ????? ??????? ?? ????? ??????? ??????. ??????? ???????? ?? ??????? ???? ??????? ????????.

### ??????? ??????? ?????? ???:
1. ? ?????? cron sync ?? Production ??? ?????????
2. ?? ?????? ??????? ?? Production logs
3. ?? ????? scheduled-sync implementation (Priority 2)
4. ?? ????? production logging service (Priority 2)

---

*?? ????? ??? ??????? ??? ??? ???? ?????*
*?????: $(date +"%Y-%m-%d %H:%M:%S")*
*?? ????? ??????? ??????: ?*
