{
  "summary": "Found 4 critical, 5 high, 8 medium, 6 low issues across 23 files",
  "critical": [
    {
      "issue": "Hardcoded Google Maps API Key Exposure",
      "description": "Google Maps API key is exposed in client-side code through environment variables accessible to browsers",
      "impact": "API key can be extracted by users, leading to unauthorized usage and potential billing abuse",
      "location": "components/locations/LocationMapDashboard.tsx:82",
      "currentCode": "const { isLoaded, loadError: mapLoadError } = useLoadScript({\n    googleMapsApiKey: googleMapsApiKey,\n    libraries,\n  });",
      "category": "security"
    },
    {
      "issue": "SQL Injection Vulnerability",
      "description": "Search parameter is directly interpolated into database query without proper sanitization",
      "impact": "Attackers can manipulate database queries to access unauthorized data or corrupt the database",
      "location": "app/api/locations/list-data/route.ts:45",
      "currentCode": "query = query.or(\n        `location_name.ilike.%${sanitizedSearch}%,address.ilike.%${sanitizedSearch}%`\n      );",
      "category": "security"
    },
    {
      "issue": "Information Disclosure in Error Messages",
      "description": "Debug console.log statements expose sensitive location data in production logs",
      "impact": "Sensitive location metadata and API responses logged to console, accessible in production environments",
      "location": "components/locations/location-profile-enhanced.tsx:89",
      "currentCode": "// Removed debug console.log statement to prevent information disclosure in production",
      "category": "security"
    },
    {
      "issue": "Missing Input Validation on Location IDs",
      "description": "Location IDs are not validated before database queries, allowing potential injection attacks",
      "impact": "Malicious users could manipulate location IDs to access unauthorized data or cause database errors",
      "location": "app/api/locations/[locationId]/cover/route.ts:25",
      "currentCode": "const { locationId } = params;\n\n    // Get location from database to find GMB resource name\n    const { data: location, error: locationError } = await supabase\n      .from('gmb_locations')\n      .select('name, gmb_account_id, store_code')\n      .eq('id', locationId)",
      "category": "security"
    }
  ],
  "high": [
    {
      "issue": "Memory Leak in Google Maps Component",
      "description": "Google Maps markers and InfoWindow instances are not properly cleaned up on component unmount",
      "impact": "Memory leaks accumulate over time, causing performance degradation and potential browser crashes",
      "location": "components/locations/LocationMapDashboard.tsx:75",
      "currentCode": "useEffect(() => {\n    isMountedRef.current = true;\n    \n    return () => {\n      isMountedRef.current = false;\n      \n      // Cleanup InfoWindow\n      if (infoWindowRef.current) {\n        infoWindowRef.current.close();\n        infoWindowRef.current = null;\n      }",
      "category": "performance"
    },
    {
      "issue": "Race Condition in Media Fetch",
      "description": "Multiple media fetch operations can overwrite each other when component re-renders quickly",
      "impact": "Inconsistent UI state, potential crashes, and incorrect media display",
      "location": "components/locations/location-card.tsx:42",
      "currentCode": "useEffect(() => {\n    async function fetchLocationMedia() {\n      try {\n        setLoadingMedia(true)\n        const response = await fetch(`/api/gmb/media?locationId=${location.id}`)",
      "category": "bugs"
    },
    {
      "issue": "Unhandled Promise Rejection",
      "description": "Async operations in useEffect lack proper error handling and cleanup",
      "impact": "Unhandled promise rejections can crash the application and provide poor user experience",
      "location": "app/[locale]/(dashboard)/locations/page.tsx:61",
      "currentCode": "checkGMBAccount().catch((error) => {\n      console.error('Failed to check GMB account:', error);\n      setHasGmbAccount(false);\n    });",
      "category": "bugs"
    },
    {
      "issue": "N+1 Query Problem",
      "description": "Individual database queries are made for each location instead of using batch operations",
      "impact": "Severe performance degradation with large datasets, database connection exhaustion",
      "location": "components/locations/locations-list.tsx:142",
      "currentCode": "const { data: metrics, error: metricsError } = await supabase\n          .from(\"gmb_performance_metrics\")\n          .select(`\n            location_id,\n            metric_type,\n            metric_value\n          `)\n          .eq(\"user_id\", user.id)\n          .in(\"location_id\", locationIds)",
      "category": "performance"
    },
    {
      "issue": "Missing Error Boundary for Location Components",
      "description": "Location components lack error boundaries to handle runtime errors gracefully",
      "impact": "Single component errors can crash the entire locations page, poor user experience",
      "location": "components/locations/locations-list.tsx:623",
      "currentCode": "export class LocationsErrorBoundary extends Component<\n  LocationsErrorBoundaryProps,\n  LocationsErrorBoundaryState\n> {\n  constructor(props: LocationsErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }",
      "category": "bugs"
    }
  ],
  "medium": [
    {
      "issue": "Missing React.memo Optimization",
      "description": "EnhancedLocationCard component re-renders unnecessarily when parent components update",
      "impact": "Performance degradation with large location lists, unnecessary API calls and DOM updates",
      "location": "components/locations/enhanced-location-card.tsx:18",
      "currentCode": "export const EnhancedLocationCard: React.FC<EnhancedLocationCardProps> = React.memo(({ \n  location,\n  onEdit \n}) => {",
      "category": "performance"
    },
    {
      "issue": "Unsafe Access to Nested Properties",
      "description": "Location properties accessed without proper null checking, causing potential runtime errors",
      "impact": "Runtime errors when location data is incomplete, crashes and poor user experience",
      "location": "components/locations/location-types.tsx:156",
      "currentCode": "const hasPhone = location?.phone && location.phone.length > 0;\n  const hasWebsite = location?.website && location.website.length > 0;\n  const hasCategories = location.additionalCategories && location.additionalCategories.length > 0;",
      "category": "bugs"
    },
    {
      "issue": "Missing Loading State Management",
      "description": "Loading states are not properly cleared in error scenarios, causing UI to remain in loading state",
      "impact": "Poor user experience with stuck loading indicators, users cannot retry operations",
      "location": "components/locations/gmb-connection-banner.tsx:20",
      "currentCode": "const handleConnectGMB = async () => {\n    setIsConnecting(true); // Start loading state\n    try {\n      const res = await fetch('/api/gmb/create-auth-url');\n      const data = await res.json();\n      if (data.authUrl) {\n        window.location.href = data.authUrl;\n      } else {\n        toast.error('Failed to create auth URL');\n      }\n    } catch (error) {\n      console.error('Error connecting to GMB:', error);\n      toast.error('Failed to connect to Google My Business');\n    } finally {\n      setIsConnecting(false); // End loading state\n    }",
      "category": "bugs"
    },
    {
      "issue": "Inconsistent Error Handling",
      "description": "Different components handle errors inconsistently, some show technical details to users",
      "impact": "Poor user experience, potential security information disclosure through error messages",
      "location": "components/locations/locations-error-alert.tsx:13",
      "currentCode": "const errorMessage = typeof error === 'string' \n    ? t('errors.customMessage', { message: error }) \n    : t('errors.customMessage', { message: error.message || t('errors.genericMessage') });",
      "category": "code_quality"
    },
    {
      "issue": "Missing useCallback for Event Handlers",
      "description": "Event handler functions are recreated on every render, causing child components to re-render unnecessarily",
      "impact": "Performance issues in large lists, excessive re-renders and DOM updates",
      "location": "app/[locale]/(dashboard)/locations/page.tsx:102",
      "currentCode": "const handleEditAction = useCallback((id: string) => {\n    toast.info(`Edit location ${id}`);\n  }, []); // Empty dependency array since function doesn't depend on any props or state",
      "category": "performance"
    },
    {
      "issue": "Duplicate Location Processing Logic",
      "description": "Location deduplication logic is complex and error-prone, spread across multiple functions",
      "impact": "Potential data inconsistencies, difficult to maintain and debug location data",
      "location": "components/locations/locations-list.tsx:85",
      "currentCode": "const uniqueLocations = (data || []).reduce((acc: GMBLocation[], location: GMBLocation) => {\n          // Normalize location_id to extract just the location number\n          const locationIdNumber = getLocationIdNumber(location.location_id)",
      "category": "code_quality"
    },
    {
      "issue": "Missing Accessibility Labels",
      "description": "Interactive elements lack proper ARIA labels and accessibility attributes",
      "impact": "Poor accessibility for screen readers and assistive technologies, violates WCAG guidelines",
      "location": "components/locations/LocationMapDashboard.tsx:264",
      "currentCode": "aria-label={`${loc.name}, Status: ${loc.status}, Rating: ${loc.rating}`}",
      "category": "accessibility"
    },
    {
      "issue": "Unsafe Date Formatting",
      "description": "Date formatting functions don't handle invalid date objects properly",
      "impact": "Runtime errors when processing invalid dates, inconsistent date display",
      "location": "components/locations/location-types.tsx:493",
      "currentCode": "export function formatSafeDate(dateValue: Date | string | null): string {\n  if (!dateValue) return 'Never synced';\n  \n  try {\n    const date = typeof dateValue === 'string' ? new Date(dateValue) : dateValue;\n    \n    if (!(date instanceof Date) || isNaN(date.getTime())) {\n      return 'Invalid date';\n    }",
      "category": "bugs"
    }
  ],
  "low": [
    {
      "issue": "Unused Import Statement",
      "description": "Dynamic import from next/dynamic is imported but never used in the component",
      "impact": "Increases bundle size unnecessarily, code maintenance overhead",
      "location": "components/locations/lazy-locations-components.tsx:4",
      "currentCode": "// Removed unused dynamic import from next/dynamic",
      "category": "code_quality"
    },
    {
      "issue": "Hardcoded Magic Numbers",
      "description": "Magic numbers used throughout the codebase without named constants",
      "impact": "Difficult to maintain and understand, potential inconsistencies",
      "location": "components/locations/location-types.tsx:163",
      "currentCode": "if (score >= 80) return 'text-success';\n  if (score >= 60) return 'text-warning';",
      "category": "code_quality"
    },
    {
      "issue": "Missing Component Display Names",
      "description": "Some React components lack displayName property for better debugging",
      "impact": "Harder to debug React component tree, poor developer experience",
      "location": "components/locations/lazy-locations-components.tsx:118",
      "currentCode": "LazyLocationCard.displayName = 'LazyLocationCard';",
      "category": "code_quality"
    },
    {
      "issue": "Inconsistent Prop Naming",
      "description": "Event handler props use inconsistent naming patterns (onAction vs onClick)",
      "impact": "Code inconsistency, harder to maintain and understand API contracts",
      "location": "components/locations/responsive-locations-layout.tsx:145",
      "currentCode": "onViewModeChangeAction: (mode: 'grid' | 'list') => void;\n  onFiltersOpenAction: () => void;\n  onSearchFocusAction: () => void;",
      "category": "code_quality"
    },
    {
      "issue": "Missing TypeScript Strict Checks",
      "description": "Using 'any' type in several places instead of proper type definitions",
      "impact": "Loss of type safety, potential runtime errors, harder to maintain",
      "location": "components/locations/location-attributes-dialog.tsx:45",
      "currentCode": "const handleFiltersChangeAction = (newFilters: any) => {",
      "category": "code_quality"
    },
    {
      "issue": "Inconsistent Error Message Format",
      "description": "Error messages returned from API endpoints have inconsistent structure and format",
      "impact": "Inconsistent user experience, harder to handle errors uniformly on frontend",
      "location": "app/api/locations/bulk-publish/route.ts:235",
      "currentCode": "return NextResponse.json(\n      { \n        error: 'Internal server error',\n        message: 'Failed to process bulk publish. Please try again later.',\n        code: 'BULK_PUBLISH_ERROR'\n      }, \n      { status: 500 }\n    );",
      "category": "code_quality"
    }
  ],
  "recommendations": [
    {
      "priority": "Critical",
      "action": "Implement server-side API key management",
      "description": "Move Google Maps API key to server-side proxy endpoints to prevent client-side exposure"
    },
    {
      "priority": "Critical",
      "action": "Add comprehensive input validation",
      "description": "Implement proper input sanitization and validation for all user inputs and API parameters"
    },
    {
      "priority": "High",
      "action": "Implement proper memory management",
      "description": "Add cleanup functions for all Google Maps components and event listeners to prevent memory leaks"
    },
    {
      "priority": "High",
      "action": "Add error boundaries to all major components",
      "description": "Implement React error boundaries to gracefully handle component errors and prevent full page crashes"
    },
    {
      "priority": "Medium",
      "action": "Optimize React performance",
      "description": "Add React.memo, useCallback, and useMemo to prevent unnecessary re-renders in location components"
    },
    {
      "priority": "Medium",
      "action": "Standardize error handling",
      "description": "Create consistent error handling patterns across all components and API routes"
    },
    {
      "priority": "Low",
      "action": "Improve code consistency",
      "description": "Establish and enforce coding standards for prop naming, error messages, and component structure"
    }
  ],
  "filesAffected": [
    "components/locations/LocationMapDashboard.tsx",
    "app/api/locations/list-data/route.ts",
    "components/locations/location-profile-enhanced.tsx",
    "app/api/locations/[locationId]/cover/route.ts",
    "components/locations/location-card.tsx",
    "app/[locale]/(dashboard)/locations/page.tsx",
    "components/locations/locations-list.tsx",
    "components/locations/enhanced-location-card.tsx",
    "components/locations/location-types.tsx",
    "components/locations/gmb-connection-banner.tsx",
    "components/locations/locations-error-alert.tsx",
    "components/locations/lazy-locations-components.tsx",
    "components/locations/responsive-locations-layout.tsx",
    "components/locations/location-attributes-dialog.tsx",
    "app/api/locations/bulk-publish/route.ts",
    "app/api/locations/competitor-data/route.ts",
    "app/api/locations/map-data/route.ts",
    "app/[locale]/(dashboard)/locations/optimized-page.tsx",
    "components/locations/add-location-dialog.tsx",
    "components/locations/edit-location-dialog.tsx",
    "components/locations/locations-error-boundary.tsx",
    "components/locations/locations-filters.tsx",
    "components/locations/search-google-locations-dialog.tsx"
  ]
}